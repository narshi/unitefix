<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Register as Service Provider - UniteFix</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #1976d2;
      --primary-dark: #004ba0;
      --text-dark: #333;
      --bg-light: #f5f9ff;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-light);
      color: var(--text-dark);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 20px 0;
      padding: 20px;
    }

    .container{
      background:#fff;
      width:90%;
      max-width:720px;
      border-radius:14px;
      padding:28px;
      box-shadow:0 10px 30px rgba(0,0,0,0.08);
    }

    h2 { color:var(--primary); text-align:center; margin:0 0 6px; font-size:28px; }
    .subtitle { text-align:center; color:#666; margin-bottom:18px; }

    label { display:block; margin:14px 0 6px; font-weight:700; color:#444; }
    input[type="text"], input[type="tel"], input[type="email"], textarea, button {
      width:100%;
      padding:12px;
      border-radius:8px;
      border:1px solid #d1d5db;
      font-size:15px;
      background: #fff;
    }

    textarea { min-height:90px; resize:vertical; }

    button {
      background:var(--primary);
      color:#fff;
      border:none;
      padding:12px;
      border-radius:10px;
      font-weight:700;
      font-size:16px;
      cursor:pointer;
      margin-top:8px;
    }
    button:hover { background:var(--primary-dark); }

    .required { color: #d33; margin-left:6px; font-weight:700; }

    /* Multi-select area */
    .multi-select-container {
      position: relative;
      margin-bottom: 8px;
      /* allow dropdown to overflow parents */
      overflow: visible;
      z-index: 2000; /* ensures dropdown sits above page content */
    }

    .multi-select-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px;
      border-radius:8px;
      border:1px solid #d1d5db;
      background:#fff;
      cursor:pointer;
      min-height:48px;
      user-select:none;
    }

    .selected-services { color:#6b7280; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; flex:1; }

    .dropdown-arrow { transition: transform .25s ease; color:#6b7280; }
    .dropdown-arrow.open { transform: rotate(180deg); }

    .multi-select-dropdown {
      position: absolute;
      top: calc(100% + 6px);
      left: 0;
      right: 0;
      background: #fff;
      border: 1px solid #d1d5db;
      border-radius:10px;
      max-height: 320px;
      overflow-y: auto;
      display: none;
      box-shadow: 0 8px 24px rgba(2,6,23,0.08);
      padding: 8px 6px;
      z-index: 3000;
    }
    .multi-select-dropdown.open { display:block; }

    .service-option {
      display:flex;
      align-items:center;      /* vertical center alignment */
      gap:10px;
      padding:8px 10px;
      border-radius:6px;
      cursor:pointer;
    }
    .service-option:hover { background:#f8fafc; }

    .service-option input[type="checkbox"] {
      margin:0;
      /* scale a bit but keep baseline stable */
      transform: scale(1.05);
      width:18px;
      height:18px;
      cursor:pointer;
      accent-color: var(--primary);
      /* ensure checkbox is vertically centered even if browsers differ */
      align-self:center;
    }

    .service-option label {
      margin:0;
      cursor:pointer;
      font-weight:500;
      color:#333;
      line-height:1.1;
    }

    /* Terms area */
    .terms-container { display:flex; align-items:center; gap:10px; margin-top:10px; }
    .terms-container input[type="checkbox"] {
      width:18px; height:18px; margin:0; transform:scale(1.02); accent-color:var(--primary);
    }
    .terms-container label { margin:0; font-weight:500; color:#333; cursor:pointer; }

    #response { margin-top:12px; text-align:center; font-weight:700; }

    .back-link { display:block; text-align:center; margin-top:14px; color:var(--primary); text-decoration:none; font-weight:600; }
    .back-link:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Service Provider Registration</h2>
    <p class="subtitle">Join our network of professional service providers</p>

    <form id="registerForm" novalidate>
      <label for="name">Full Name <span class="required">*</span></label>
      <input id="name" name="name" type="text" required>

      <label for="phone">Phone Number <span class="required">*</span></label>
      <input id="phone" name="phone" type="tel" pattern="[0-9]{10}" placeholder="10-digit number" required>

      <label for="email">Email (optional)</label>
      <input id="email" name="email" type="email">

      <label for="address">Address <span class="required">*</span></label>
      <textarea id="address" name="address" required></textarea>

      <label>Services You Provide <span class="required">*</span></label>
      <div class="multi-select-container">
        <div class="multi-select-header" id="multiSelectHeader" aria-haspopup="listbox" role="button" tabindex="0">
          <span class="selected-services" id="selectedServicesDisplay">Select services...</span>
          <i class="fas fa-chevron-down dropdown-arrow" id="dropdownArrow"></i>
        </div>

        <div class="multi-select-dropdown" id="multiSelectDropdown" role="listbox" aria-multiselectable="true">
          <!-- each checkbox has an id and matching label for proper click behavior -->
          <div class="service-option"><input id="s1" name="services" type="checkbox" value="Computer & Printer"><label for="s1">Computer & Printer</label></div>
          <div class="service-option"><input id="s2" name="services" type="checkbox" value="CCTV Camera"><label for="s2">CCTV Camera</label></div>
          <div class="service-option"><input id="s3" name="services" type="checkbox" value="Biometric Device"><label for="s3">Biometric Device</label></div>
          <div class="service-option"><input id="s4" name="services" type="checkbox" value="UPS & Batteries"><label for="s4">UPS & Batteries</label></div>
          <div class="service-option"><input id="s5" name="services" type="checkbox" value="Water Purifiers"><label for="s5">Water Purifiers</label></div>
          <div class="service-option"><input id="s6" name="services" type="checkbox" value="Internet & Broadband"><label for="s6">Internet & Broadband</label></div>
          <div class="service-option"><input id="s7" name="services" type="checkbox" value="Solar & Heat Pumps"><label for="s7">Solar & Heat Pumps</label></div>
          <div class="service-option"><input id="s8" name="services" type="checkbox" value="WTP & STP"><label for="s8">WTP & STP</label></div>
          <div class="service-option"><input id="s9" name="services" type="checkbox" value="Mobile Repairs"><label for="s9">Mobile Repairs</label></div>
          <div class="service-option"><input id="s10" name="services" type="checkbox" value="Digital Camera Services"><label for="s10">Digital Camera Services</label></div>
          <div class="service-option"><input id="s11" name="services" type="checkbox" value="Home Appliances"><label for="s11">Home Appliances</label></div>
          <div class="service-option"><input id="s12" name="services" type="checkbox" value="Generators, Water Pumps, Water Cutoff Sensors"><label for="s12">Generators, Water Pumps, Water Cutoff Sensors</label></div>
          <div class="service-option"><input id="s13" name="services" type="checkbox" value="Household Repairs"><label for="s13">Household Repairs</label></div>
          <div class="service-option"><input id="s14" name="services" type="checkbox" value="Electrical & Plumbing"><label for="s14">Electrical & Plumbing</label></div>
          <div class="service-option"><input id="s15" name="services" type="checkbox" value="Architecture"><label for="s15">Architecture</label></div>
          <div class="service-option"><input id="s16" name="services" type="checkbox" value="Vehicle Service"><label for="s16">Vehicle Service</label></div>
          <div class="service-option"><input id="s17" name="services" type="checkbox" value="Agriculture Product Services"><label for="s17">Agriculture Product Services</label></div>
          <div class="service-option"><input id="s18" name="services" type="checkbox" value="Earth Movers"><label for="s18">Earth Movers</label></div>
          <div class="service-option"><input id="s19" name="services" type="checkbox" value="Packers & Movers"><label for="s19">Packers & Movers</label></div>
          <div class="service-option"><input id="s20" name="services" type="checkbox" value="Pest Controlling System"><label for="s20">Pest Controlling System</label></div>
          <div class="service-option"><input id="s21" name="services" type="checkbox" value="Tax & Audit"><label for="s21">Tax & Audit</label></div>
          <div class="service-option"><input id="s22" name="services" type="checkbox" value="DTH Services"><label for="s22">DTH Services</label></div>
          <div class="service-option"><input id="s23" name="services" type="checkbox" value="Travel & Tourism"><label for="s23">Travel & Tourism</label></div>
          <div class="service-option"><input id="s24" name="services" type="checkbox" value="Hotels, Homestay, Lodge, Restaurant & Resorts"><label for="s24">Hotels, Homestay, Lodge, Restaurant & Resorts</label></div>
          <div class="service-option"><input id="s25" name="services" type="checkbox" value="Real Estate"><label for="s25">Real Estate</label></div>
          <div class="service-option"><input id="s26" name="services" type="checkbox" value="Driving School"><label for="s26">Driving School</label></div>
          <div class="service-option"><input id="s27" name="services" type="checkbox" value="Loans & All Types of Insurance"><label for="s27">Loans & All Types of Insurance</label></div>
          <div class="service-option"><input id="s28" name="services" type="checkbox" value="Astrology Services"><label for="s28">Astrology Services</label></div>
          <div class="service-option"><input id="s29" name="services" type="checkbox" value="Event Management"><label for="s29">Event Management</label></div>
          <div class="service-option"><input id="s30" name="services" type="checkbox" value="Interior Design"><label for="s30">Interior Design</label></div>
          <div class="service-option"><input id="s31" name="services" type="checkbox" value="Welding"><label for="s31">Welding</label></div>
          <div class="service-option"><input id="s32" name="services" type="checkbox" value="Catering Services"><label for="s32">Catering Services</label></div>
          <div class="service-option"><input id="s33" name="services" type="checkbox" value="Lawyers & Advocates"><label for="s33">Lawyers & Advocates</label></div>
          <div class="service-option"><input id="s34" name="services" type="checkbox" value="Hardware & Painting"><label for="s34">Hardware & Painting</label></div>
          <div class="service-option"><input id="s35" name="services" type="checkbox" value="Education"><label for="s35">Education</label></div>
          <div class="service-option"><input id="s36" name="services" type="checkbox" value="Health"><label for="s36">Health</label></div>
        </div>
      </div>

      <input type="hidden" id="selectedServicesInput" name="serviceRequest">

      <div class="terms-container">
        <input id="terms" name="terms" type="checkbox" required>
        <label for="terms">
          I agree to all the 
          <a href="assets/terms-and-conditions.pdf" target="_blank" rel="noopener noreferrer">
            <strong>Terms and Conditions</strong>
          </a>.
        </label>
      </div>

      <button type="submit">Submit Registration</button>
      <p id="response" aria-live="polite"></p>
    </form>

    <a class="back-link" href="index.html">← Back to Home</a>
  </div>

  <script>
    (function(){
      const header = document.getElementById('multiSelectHeader');
      const dropdown = document.getElementById('multiSelectDropdown');
      const arrow = document.getElementById('dropdownArrow');
      const display = document.getElementById('selectedServicesDisplay');
      const hiddenInput = document.getElementById('selectedServicesInput');
      const serviceCheckboxes = Array.from(document.querySelectorAll('input[name="services"]'));

      // Toggle dropdown on click or Enter/Space
      header.addEventListener('click', toggleDropdown);
      header.addEventListener('keydown', function(e){
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleDropdown(); }
      });

      function toggleDropdown(){
        dropdown.classList.toggle('open');
        arrow.classList.toggle('open');
      }

      // Close when clicking outside
      document.addEventListener('click', function(e){
        if (!header.contains(e.target) && !dropdown.contains(e.target)) {
          dropdown.classList.remove('open');
          arrow.classList.remove('open');
        }
      });

      // update display text and hidden input
      function updateSelectedServices(){
        const selected = serviceCheckboxes.filter(cb => cb.checked).map(cb => cb.value);
        if (!selected.length){
          display.textContent = 'Select services...';
          hiddenInput.value = '';
        } else if (selected.length === 1){
          display.textContent = selected[0];
          hiddenInput.value = selected.join(', ');
        } else {
          display.textContent = `${selected.length} services selected`;
          hiddenInput.value = selected.join(', ');
        }
      }

      serviceCheckboxes.forEach(cb => {
        cb.addEventListener('change', updateSelectedServices);
      });

      // initialize
      updateSelectedServices();

      // Form submit handling
      const form = document.getElementById('registerForm');
      const responseEl = document.getElementById('response');
      const submitBtn = form.querySelector('button[type="submit"]');
      const scriptURL = "https://script.google.com/macros/s/AKfycbw8vdgRz0vztwgrrsOQiQ_QdmdnoQxFl0pmunDOciwHTjOcnrCVtg8ME8t4derFdy1P/exec";

      form.addEventListener('submit', async function(e){
        e.preventDefault();

        // native validation first
        if (!form.checkValidity()){
          // show native browser UI for first invalid control
          form.reportValidity();
          return;
        }

        // ensure at least one service selected
        const selected = serviceCheckboxes.filter(cb => cb.checked);
        if (selected.length === 0){
          responseEl.textContent = "⚠️ Please select at least one service.";
          responseEl.style.color = "orange";
          return;
        }

        responseEl.textContent = "Submitting...";
        responseEl.style.color = "gray";
        submitBtn.disabled = true;

        try {
          const res = await fetch(scriptURL, { method: 'POST', body: new FormData(form) });
          // try to parse JSON safely
          let data;
          try { data = await res.json(); } catch {
            const txt = await res.text();
            responseEl.textContent = "Server response: " + txt;
            responseEl.style.color = "red";
            submitBtn.disabled = false;
            return;
          }
          if (data && data.success){
            responseEl.textContent = "✅ Success! Thank you for registering. We will contact you shortly.";
            responseEl.style.color = "green";
            form.reset();
            updateSelectedServices();
            setTimeout(()=> location.href = 'index.html', 2500);
          } else {
            throw new Error(data && data.message ? data.message : 'Server error');
          }
        } catch (err) {
          console.error(err);
          responseEl.textContent = "❌ Something went wrong. Please try again later.";
          responseEl.style.color = "red";
        } finally {
          submitBtn.disabled = false;
        }
      });
    })();
  </script>
</body>
</html>
